/* HorizontalizedMenu v.0.2a GPL 3.0 http://www.gnu.org/licenses/gpl-3.0.html @copyright Mazdak Farrokhzad <twingoow@gmail.com> */ (function(b){var m,n;b.horizontalizedMenu={settings:{fadeTime:300,easing:"swing",verticalMovement:!0,pointerShow:!0,pointerAdjust:!0,pointerMake:!0,widthFullDeep:!1,widthReduce:"left",outerWidth:!0},classes:{base:"horizontalizedMenu",active:"hover",sub:"menu-sub",content:"menu-sub-content",pointer:"menu-sub-pointer",pointerBorder:"menu-sub-pointer-border"}};var f=b.horizontalizedMenu.classes,g=function(a){a instanceof g?this.val=a.val:(this.val=a,this.normalize())};b.extend(g,{MOD_CIRCLE:2*Math.PI, fromVector:function(a){return new g(Math.atan2(a.y,a.x))},fromDeg:function(a){return new g(Math.PI/180*a)}});g.prototype={normalize:function(){this.val=(this.val+g.MOD_CIRCLE)%g.MOD_CIRCLE;return this},isOpposite:function(a,b){var a=new g(a),d=new g(a.val+Math.PI-b/2),c=new g(a.val+Math.PI+b/2);if(d.val>c.val)var s=d,d=c,c=s;return this.val>=d.val&&this.val<=c.val},toDeg:function(){return 180/Math.PI*this.val}};var o=function(a,b,d){var c=d/m-1,b=-1*Math.log(n/c)/b;return Math.round(d/Math.sqrt(1+ c*Math.exp(-b*a)))};m=0.05;n=Math.pow(10,-10);var p=function(a){return b.grep(b.isArray(a)?a:[a],function(a){return a})},h=function(a){return b.map(p(a),function(a){return"."+a}).join(",")},l=function(a,e){(e||a.data).toggleClass(f.active,a instanceof b.Event?a.type in{mouseenter:1,focus:1}:a)},q=function(a,e){a.siblings(e).length||b("<div>").insertBefore(a).addClass(e)},i=function(a,b,d,c){return parseInt(a.css(p([b,"l"===d?"left":"right",c]).join("-")))},j=function(a,b){return i(a,"border",b,"width")}, r=function(a,b){return i(a,"padding",b)+j(a,b)+i(a,"margin",b)},t=function(a,e,d){var c=this;this.sub=b(a);this.root=e;this.li=this.sub.parent();this.parent=this.li.parent();this.content=this.sub.closestDescendant(h(f.content)).first();d.pointerMake&&(q(this.content,f.pointerBorder),q(this.content,f.pointer));b.extend(this,{adjust:function(){this.adjustWidth();this.pointer.calcAdjustment()},adjustWidth:function(){var a=false;if(!this.parent.is(this.root))if(d.widthFullDeep)a=true;else return;var c= 0,e=0;if(a){if(d.widthReduce!=="center"){var a=this.li.parentsUntil(h(f.sub)).not(this.parent),a=a.last().parent().is(h(f.sub))?a:b(),g=i(this.parent,"margin","r"),k=i(this.parent,"margin","l");a.each(function(){g=g+r(b(this),"r");k=k+r(b(this),"l")});d.widthReduce in{right:1,none:1}&&(c=c+k)&&(e=e+k);d.widthReduce in{left:1,none:1}&&(c=c+g)}}else e=e-i(this.parent,"padding","l");this.sub.width(c+this.parent[d.outerWidth?"outerWidth":"width"]());e=e+(this.li.position().left+(d.outerWidth?j(this.parent, "l"):0)+j(this.li,"l")+i(this.li,"margin","l"));this.sub.css("margin-left","-"+e+"px")},pointer:{elem:this.content.siblings(h(f.pointer)),adjustLeft:!1,adjusted:!1,calcAdjustment:function(){if(d.pointerShow&&d.pointerAdjust){this.adjustLeft=-1*i(c.sub,"margin","l")-this.elem.outerWidth()/2;this.adjusted=false}},adjust:function(){this.elem.siblings(h(f.pointerBorder)).add(this.elem).toggle(d.pointerShow);if(d.pointerShow&&d.pointerAdjust&&!this.adjusted){this.adjusted=true;this.elem.css("left",this.adjustLeft= this.adjustLeft+(c.li.outerWidth()-j(c.li,"l")-j(c.li,"r"))/2).prev().css("left",++this.adjustLeft)}}},hover:function(a){var e=(a instanceof b.Event?a.type:a)in{mouseenter:1,show:1};l(e,this.li);if(e){this.sub.css({display:"block",opacity:0});this.adjust()}var f=this.li.width(),h=this.li.height(),i=this.li.offset(),a=g.fromVector({x:(a.pageX-i.left-f/2)*(h/f),y:(a.pageY-i.top-h/2)*(f/h)}),a={left:(a.isOpposite(0,Math.PI)?1:-1)*o(this.sub.width(),this.root.width(),this.moveDistance.x),top:d.verticalMovement&& (e||!a.isOpposite(Math.PI/2,Math.PI))?o(this.sub.height(),this.root.height(),this.moveDistance.y):0};this.pointer.adjust();if(e){this.sub.css(a);a.left=a.top=0}this.sub.stop(false,true).animate(b.extend(a,{opacity:e?1:0}),{duration:d.fadeTime,easing:d.easing,complete:function(){!e&&c.sub.css("display","none")}})},bind:function(){this.li.bind("mouseenter.horizontalizedMenu, mouseleave.horizontalizedMenu",b.proxy(this.hover,this)).children("a").bind("focus.horizontalizedMenu",function(){!c.sub.is(":visible")&& c.hover("mouseenter");b(document).bind("focusin.horizontalizedMenu",function(a){if(!b(":focus",c.li).length){b(document).unbind(a);c.hover("mouseleave")}})})},unbind:function(){this.li.children("a").andSelf().add(document).unbind(".horizontalizedMenu")}});this.moveDistance={x:Math.abs(parseInt(this.sub.css("left"))),y:Math.abs(parseInt(this.sub.css("top")))};this.bind()},u=function(a,e){this.root=b(a).data("horizontalizedMenu",this);this.width=this.root.outerWidth();b.extend(this,{hidePointers:function(){this.root.find(h([f.pointer, f.pointerBorder])).hide()},showPointers:function(){this.root.find(h([f.pointer,f.pointerBorder])).hide()}});this.resized=function(){this.width!==this.root.outerWidth()&&(this.width=this.root.outerWidth(),this.root.find(h(f.sub)).each(function(){b(this).data("horizontalizedMenu-sub").adjust()}))};b(window).resize(b.proxy(this.resized,this));this.root.find(h(f.sub)).each(b.proxy(function(a,c){b(c).data("horizontalizedMenu-sub",new t(c,this.root,e))},this));this.root.find("li:not(:has(.menu-sub))").each(function(){b(this).bind("mouseenter.horizontalizedMenu, mouseleave.horizontalizedMenu", b(this),l).children("a").bind("focus.horizontalizedMenu, blur.horizontalizedMenu",b(this),l)})};b.fn.horizontalizedMenu=function(a){var e=arguments,d=!1,c="string"===b.type(a)?a:!1;return this.each(function(){var f=b(this).data("horizontalizedMenu");f||(d||(d=!0,a=b.extend(!0,{},b.horizontalizedMenu.settings,c?{}:a)),f=new u(this,a));c&&f[c].apply(f,e)})};var v=jQuery.find.matchesSelector;b.fn.closestDescendant=function(a){var e,d,c,f=[];this.each(function(){e=[this];for(d=[];e.length;)if((c=e.shift())&& 1===c.nodeType){if(v(c,a)){f.push(c);break}d.unshift.apply(d,b(c).children().toArray());e.length||(e.unshift.apply(e,d),d=[])}});f=1<f.length?b.unique(f):f;return this.pushStack(f,"closestDescendant",a)}})(jQuery);